<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width initial-scale=1">

<meta property="og:title" content="Udacity lecture 03">
<title>Udacity lecture 03</title>
<meta property="og:description" content="Udacity Deep learning 3강영상 처리에서 Convolution은 널리 알려진 연산자이다. Convolutional Neural Network(CNN)는 네트워크의 히든 레이어를 구성할때 Convolution 연산을 사용한다. 이때 특이한 점은, input의 dept...">
<meta property="og:url" content="/deep%20learning/2016/03/28/udacity-lec03.html">
<meta property="og:site_name" content="Kwangjin Yoon">
<meta property="og:locale" content="en_US">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@">
<meta name="twitter:creator" content="@">
<meta name="twitter:title" content="Udacity lecture 03">
<meta name="twitter:description" content="Udacity Deep learning 3강영상 처리에서 Convolution은 널리 알려진 연산자이다. Convolutional Neural Network(CNN)는 네트워크의 히든 레이어를 구성할때 Convolution 연산을 사용한다. 이때 특이한 점은, input의 dept...">
<meta name="twitter:url" content="/deep%20learning/2016/03/28/udacity-lec03.html">

<meta name="keywords" content="Computer Science, Machine Learning, Computer Vision, Pattern Recognition">

<link rel="icon" href="/images/github.png">
<link rel="stylesheet" href="/css/main.css">
<link rel="canonical" href="/deep%20learning/2016/03/28/udacity-lec03.html">
<link rel="alternate" type="application/atom+xml" title="Kwangjin Yoon" href="/feed.xml" />

<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->

<script language="Javascript" type="text/javascript">
function search_google()
{
  var query = document.getElementById("google-search").value;
  window.open("http://google.com/search?q=" + query
      + "%20site:" + "");
}
</script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>


<script type='text/javascript'>
var blocklink = ['http://humanorightswatch.org','http://o-o-6-o-o.com','http://darodar.com','http://blackhatworth.com','http://hulfingtonpost.com','http://bestwebsitesawards.com','http://darodar.com','http://buttons-for-website.com','http://ilovevitaly.co','http://semalt.com','http://priceg.com','http://simple-share-buttons.com','http://googlsucks.com','http://4webmasters.org','http://aliexpress.com','http://addons.mozilla.org/en-US/firefox/addon/ilovevitaly/','http://free-share-buttons.com','http://buttons-for-your-website.com','http://theguardlan.com','http://buy-cheap-online.info','http://best-seo-offer.com','http://4webmasters.org','http://trafficmonetize.org','http://howtostopreferralspam.eu','http://ilovevitaly.com','http://sanjosestartups.com','http://free-social-buttons.com','http://best-seo-offer.com','http://guardlink.org','http://www.event-tracking.com','http://www3.free-social-buttons.com','http://www1.free-social-buttons.com','http://www2.free-social-buttons.com','http://websites-reviews.com','http://floating-share-buttons.com','http://satellite.maps.ilovevitaly.com','http://free-social-buttons.com','http://www.event-tracking.com','http://erot.co'];
for (var b = blocklink.length; b--;) {
  if (document.referrer.match(blocklink[b]))
    window.location = "http://www.google.com";
}
</script>




</head>


<body>

<div class="container">

  <header class="site-header">

  <div class="wrapper">

    <h1 class="site-title"><a href="/">Kwangjin Yoon</a></h1>
    <h3 class="site-meta">Dream big, Work hard, Stay humble.</h3>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">
        
        
        <a class="page-link" href="/">Home</a>
        
        
        
        <a class="page-link" href="/about/">About</a>
        
        
        
        <a class="page-link" href="/archives/">Archives</a>
        
        
        
        <a class="page-link" href="/categories/">Categories</a>
        
        
        
        <a class="page-link" href="/tags/">Tags</a>
        
        
        
        <a class="page-link" href="/guestbook/">Guestbook</a>
        
        
        
        <a class="page-link" href="/feed.xml">Subscribe</a>
        
        
        
        
        
        
      </div>
    </nav>

  </div>

</header>


    

  <div class="page-content col-sm-8">
    <div class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 itemprop="name" class="post-title">Udacity lecture 03</h1>
    <meta itemprop="keywords" content="Deep learning,Tensorflow,Udacity lecture" />
    <p class="post-meta">
    Posted in
    
    <a href="/categories/#Deep learning">Deep learning</a>
     
    
    and tagged
    
    <a href="/tags/#Deep learning" title="Deep learning">Deep learning</a>, 
    
    <a href="/tags/#Tensorflow" title="Tensorflow">Tensorflow</a>, 
    
    <a href="/tags/#Udacity lecture" title="Udacity lecture">Udacity lecture</a>
    
    
    <time itemprop="datePublished" datetime="2016-03-28">
    on Mar 28, 2016
    </time>
    </p>
  </header>

  <article class="post-content" itemprop="articleBody">
    <h2 id="udacity-deep-learning-3">Udacity Deep learning 3강</h2>
<p><br />
영상 처리에서 Convolution은 널리 알려진 연산자이다. Convolutional Neural Network(CNN)는 네트워크의 히든 레이어를 구성할때 Convolution 연산을 사용한다. 이때 특이한 점은, input의 depth와 output의 depth가 다를 수 있다. 아래 그림을 보면 input은 3채널의 영상으로 depth가 3이지만 output은 depth가 K인 것을 확인할 수 있다.</p>

<p><img src="https://i.imgur.com/Gov5CHo.png" alt="img1" title="con" /></p>

<!-- more -->

<p><br />
아래 그림은 Feature Map의 Dimension을 구체적으로 나타내면서 CNN의 구조를 파악한 것이다. 우선 처음 두개의 레이어를 보면, 첫번째 입력으로 256x256 크기의 3채널 영상이 주어졌고 그로부터 depth가 16인 128x128짜리 Feature map이 생성된 것을 볼 수가 있다. 이것으로부터 유추해보면, stride가 2인 convolution 연산이 있었음을 생각해 볼수 있다. 또 depth를 3에서 16으로 증강시키는 convolution 연산이 있었음을 생각해 볼수 있다.</p>

<p><img src="https://i.imgur.com/c65a4Yf.png" alt="img2" title="conv" /></p>

<p><br />
Udacity 3강의 숙제에서 CNN의 Network 구조에 관련된 코드이다.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># Model.</span>
<span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
  <span class="n">conv</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">layer1_weights</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="s">'SAME'</span><span class="p">)</span>
  <span class="n">hidden</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">conv</span> <span class="o">+</span> <span class="n">layer1_biases</span><span class="p">)</span>
  <span class="n">conv</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">layer2_weights</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="s">'SAME'</span><span class="p">)</span>
  <span class="n">hidden</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">conv</span> <span class="o">+</span> <span class="n">layer2_biases</span><span class="p">)</span>
  <span class="n">shape</span> <span class="o">=</span> <span class="n">hidden</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
  <span class="n">reshape</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="p">[</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
  <span class="n">hidden</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">reshape</span><span class="p">,</span> <span class="n">layer3_weights</span><span class="p">)</span> <span class="o">+</span> <span class="n">layer3_biases</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">layer4_weights</span><span class="p">)</span> <span class="o">+</span> <span class="n">layer4_biases</span>

</code></pre>
</div>

<p>우선 위 코드에서 model 함수가 받는 인자 data는 1채널의 28x28 사이즈 영상이다.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code>  <span class="n">conv</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">layer1_weights</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="s">'SAME'</span><span class="p">)</span>
  <span class="n">hidden</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">conv</span> <span class="o">+</span> <span class="n">layer1_biases</span><span class="p">)</span>
</code></pre>
</div>
<p>위에서 layer1_weights 변수는 CNN의 첫번째 convolution kernel이고 1x5x5x16의 크기를 가지며, tf.nn.conv2d 함수에 의해 2칸씩 stride를 하며 convolution을 한다. kernel dimension의 처음 세개(1x5x5)는 input patch의 size를 말하고, 마지막 16은 convolution의 output depth의 size를 말한다.이다. layer1_biases의 dimension은 1x16이며 convolution 연산의 결과에 더하여 ReLu의 입력이 된다. 즉, 첫번째 hidden layer의 dimension은 14x14x16이 된다.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code>  <span class="n">conv</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">layer2_weights</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="s">'SAME'</span><span class="p">)</span>
  <span class="n">hidden</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">conv</span> <span class="o">+</span> <span class="n">layer2_biases</span><span class="p">)</span>
</code></pre>
</div>

<p>두 번째 hidden layer를 구성하기 위한 부분이고, layer2_weights의 dimension은 16x5x5x16이고 이것 역시 2칸씩 stride를 하며 convolution을 한다. 이렇게 해서 생성되는 hidden layer는 다시 한번 크기가 줄어 7x7x16이 된다.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code>  <span class="n">shape</span> <span class="o">=</span> <span class="n">hidden</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
  <span class="n">reshape</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="p">[</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
  <span class="n">hidden</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">reshape</span><span class="p">,</span> <span class="n">layer3_weights</span><span class="p">)</span> <span class="o">+</span> <span class="n">layer3_biases</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">hidden</span><span class="p">,</span> <span class="n">layer4_weights</span><span class="p">)</span> <span class="o">+</span> <span class="n">layer4_biases</span>
</code></pre>
</div>

<p>이 부분부터는 convolution이 적용되지 않았다.
7x7x16의 feature map을 1x784의 벡터로 변형한다. tf.reshape( … ) 함수가 그 부분이다.
그리고 784x64 크기의 매트릭스와 곱셈하고 1x64 크기의 벡터 bias와 더하여 다음 1x64짜리 layer를 만든다. 위의 세 번째 줄이 그것이다. 마지막으로 64x10짜리 매트릭스인 layer4_weights와 1x10짜리 벡터 layer4_biases를 사용해 최종 output인 logits을 얻는다.</p>


  </article>
  <hr />
</div>


<section class="pager">
  <ul>
    
    <li class="previous"><a href="/algorithms/2015/07/12/networkflow.html" title="Minimum cost flow">&larr; Older</a></li>
    
    
    <li class="disabled"><a>Newer &rarr;</a>
    
  </ul>
</section>

<script src="/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = '/algorithms/2015/07/12/networkflow.html';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>



<div id="disqus_thread"></div>

<script type="text/javascript">

  var disqus_developer = 1;

var disqus_shortname ='yoon28';
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>

<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



    <section class="pager">
  
  
</section>

<script src="/js/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>



  </div>
  <div class="col-sm-2">
<div class="sidebar-module about">
  <h4>About Me</h4>
  <img title="Kwangjin Yoon, 윤광진" src="/images/space.jpg" alt="Kwangjin Yoon, 윤광진"/>
  <span>Hello!<br>My name is Kwangjin Yoon[윤광진] from South Korea.</span>
  <br />

  

</div>

<div class="sidebar-module">
  <h4>Site Search</h4>
  <form onsubmit="search_google()" >
    <input type="text" id="google-search" placeholder="Google search" />
    <input type="submit" name="sa" value="Go" />
  </form>
</div>


<div class="sidebar-module"> <!-- sidebar-module-inset">-->
  <h4>Copyright Notice</h4>

  

  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">
    <img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png">
  </a>
  <!-- <br />
  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Attribution-NonCommercial-ShareAlike</a>
  -->
  

</div>


<div class="sidebar-module">
  <h4>Recent Posts</h4>
  
  <li>
  <a href="/deep%20learning/2016/03/28/udacity-lec03.html" title="Udacity lecture 03" rel="bookmark">Udacity lecture 03</a>
  </li>
  
  <li>
  <a href="/algorithms/2015/07/12/networkflow.html" title="Minimum cost flow" rel="bookmark">Minimum cost flow</a>
  </li>
  
</div>


<div class="sidebar-module">
  <h4>Categories</h4>
  
  <li><a href="/categories/#Algorithms" title="Algorithms" rel="1">Algorithms (1)</a></li>
  
  <li><a href="/categories/#Deep learning" title="Deep learning" rel="1">Deep learning (1)</a></li>
  
</div>


<div class="sidebar-module">
  <h4>Tags</h4>
  
    <a href="/tags/#Min cost flow" title="Min cost flow" rel="1">Min cost flow</a> &nbsp;
  
    <a href="/tags/#Deep learning" title="Deep learning" rel="1">Deep learning</a> &nbsp;
  
    <a href="/tags/#Tensorflow" title="Tensorflow" rel="1">Tensorflow</a> &nbsp;
  
    <a href="/tags/#Udacity lecture" title="Udacity lecture" rel="1">Udacity lecture</a> &nbsp;
  
</div>


<!-- <div class="sidebar-module">
  <h4>Blogroll</h4>
  
  <li><a href="http://yulijia.net/freshman" title="Another Jekyll blog theme">Freshman</a></li>
  
  <li><a href="http://yulijia.net/" title="Lijia Yu's website">author's website</a></li>
  
</div>

 -->
<div class="sidebar-module">
  <h4>Archives</h4>

  
  
  
  
  
  <li id="2016" > <a href="/archives/#2016">2016</a></li>
  
  
  
  
  
  
  <li id="2015" > <a href="/archives/#2015">2015</a></li>
  
  

</div>


</div>



  

  <footer class="site-footer">

  <p>Copyright &copy; <a href="/">Kwangjin Yoon</a></p>
  <p>Powered by <a href="https://github.com/jekyll/jekyll">Jekyll</a> 
  on 
  
  <a href="https://github.com/">Github</a>
  
  | Theme <a href="https://github.com/yulijia/freshman21/">Freshman21</a> Design by <a href="http://yulijia.net">Lijia Yu</a>  


  <div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
    <a title="Back To Top"><img src="/images/topbutton.png"/></a>
  </div>

  <script src="/js/jquery-1.9.1.min.js"></script>
  <script src="/js/totop.js"></script>  



</footer>


</div>

</body>

</html>
